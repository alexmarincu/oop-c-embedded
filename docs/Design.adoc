= Design
:sectnums:
:imagesdir: media

[plantuml, target=diag-overview]
.Design overview
----
skinparam linetype ortho
package lib <<Frame>> {
    package timer <<Frame>> {
        interface TimeSource
        class Timer
        Timer -> TimeSource
    }
    package observer <<Frame>> {
        interface Observer
        abstract class Subject
        Subject -> Observer
    }
}
package acceleration <<Frame>> {
    class Acceleration3d
}
package acc_config <<Frame>> {
    class AccConfig
    interface AccConfigDao
    AccConfigDao .> AccConfig
}
package motion_detector <<Frame>> {
    class AccelerationAccumulator
    class AccelerationMagnitudeTracker
    class MotionDetector
    AccelerationAccumulator -u-> Acceleration3d
    MotionDetector .u.> Acceleration3d
    MotionDetector -> AccelerationAccumulator
    MotionDetector -> AccelerationMagnitudeTracker
    MotionDetector -u-> Timer
}
package acc_configurator <<Frame>> {
    class AccConfigurator
    AccConfigurator -u-> AccConfigDao
    AccConfigurator .u.> AccConfig
}
package acc_ctrl <<Frame>> {
    class AccCtrl
    AccCtrl .u.> Acceleration3d
    AccCtrl -u-> MotionDetector
}
package button_ctrl <<Frame>> {
    class ButtonCtrl
    ButtonCtrl -u-> AccConfigurator
}
package acc_config_storage <<Frame>> {
    class AccConfigStorage
    AccConfigStorage -u-|> Subject
    AccConfigStorage -u-> Observer
    AccConfigStorage .u.|> AccConfigDao
    AccConfigStorage -u-> AccConfig
}
package acc_driver <<Frame>> {
    abstract class AccDriver
    class ActualAccDriver
    class ActualAccSimDriver
    class AccDriverProvider
    AccDriver -u-> AccCtrl
    ActualAccDriver -|> AccDriver
    ActualAccDriver -u-> AccCtrl
    ActualAccDriver .u.> Acceleration3d
    ActualAccSimDriver -|> AccDriver
    ActualAccSimDriver -u-> AccCtrl
    ActualAccSimDriver .u.> Acceleration3d
    AccDriverProvider .u.|> Observer
    AccDriverProvider .u.> Subject
    AccDriverProvider -u-> AccConfigStorage
    AccDriverProvider -> ActualAccDriver
    AccDriverProvider -> ActualAccSimDriver
    AccDriverProvider -> AccDriver
}
package button_driver <<Frame>> {
    class ButtonDriver
    ButtonDriver -u-> ButtonCtrl
}
package os <<Frame>> {
    class os_Interrupts
    class os_KeyHandler
    class os_Time
    class os_Task
    class os_Scheduler
    class Os
    Os -> os_KeyHandler
    Os -> os_Scheduler
    os_KeyHandler -> Os
    os_KeyHandler .> os_Interrupts
    os_Interrupts .u.> ButtonDriver
    os_Interrupts .u.> AccDriver
    os_Interrupts .u.> ActualAccDriver
    os_Interrupts .u.> ActualAccSimDriver
    os_Scheduler -u-> ButtonDriver
    os_Scheduler -u-> AccDriverProvider
    os_Scheduler -u-> MotionDetector
    os_Scheduler -> os_Task
    os_Scheduler .u.> AccConfigStorage
    os_Scheduler .u.> AccConfigurator
    os_Scheduler .u.> AccDriver
    os_Scheduler .u.> ButtonCtrl
    os_Scheduler .> os_Time
    os_Scheduler .u.> Timer
    os_Task -> os_Time
    os_Time .u.|> TimeSource
}
----
