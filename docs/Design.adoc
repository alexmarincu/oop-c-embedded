= Design
:sectnums:
:imagesdir: media

[plantuml, target=diag-overview]
.Design overview
----
skinparam ArrowColor Gray
skinparam PackageBackgroundColor #DDDDDD
skinparam Linetype ortho
package lib {
    package timer {
        interface TimeSource
        class Timer
        Timer -> TimeSource
    }
    package observer {
        interface Observer
        abstract class Subject
        Subject -> Observer
    }
}
package accelerometer_data_models {
    class Acceleration3d
    class AccelerometerConfig
    interface AccelerometerConfigDao
    AccelerometerConfigDao .[dotted]> AccelerometerConfig
}
package motion_detector {
    class AccelerationAccumulator
    class AccelerationMagnitudeTracker
    class MotionDetector
    AccelerationAccumulator --u> Acceleration3d
    MotionDetector ..u[dotted]> Acceleration3d
    MotionDetector --u> AccelerationAccumulator
    MotionDetector --u> AccelerationMagnitudeTracker
    MotionDetector --u> Timer
}
package accelerometer_configurator {
    class AccelerometerConfigurator
    AccelerometerConfigurator --u> AccelerometerConfigDao
    AccelerometerConfigurator ..u[dotted]> AccelerometerConfig
}
package accelerometer_controller {
    class AccelerometerCtrl
    AccelerometerCtrl ..u[dotted]> Acceleration3d
    AccelerometerCtrl --u> MotionDetector
}
package button_controller {
    class ButtonCtrl
    ButtonCtrl -> AccelerometerConfigurator
}
package accelerometer_data_storage {
    class AccelerometerConfigStorage
    AccelerometerConfigStorage --u|> Subject
    AccelerometerConfigStorage --u> Observer
    AccelerometerConfigStorage ..u[dotted]|> AccelerometerConfigDao
    AccelerometerConfigStorage --u> AccelerometerConfig
}
package accelerometer_driver {
    abstract class AccelerometerDriver
    class RealAccelerometerDriver
    class AccelerometerSimulatorDriver
    class AccelerometerDriverProvider
    AccelerometerDriver --u> AccelerometerCtrl
    RealAccelerometerDriver --u|> AccelerometerDriver
    RealAccelerometerDriver --u> AccelerometerCtrl
    RealAccelerometerDriver ..u[dotted]> Acceleration3d
    AccelerometerSimulatorDriver --u|> AccelerometerDriver
    AccelerometerSimulatorDriver --u> AccelerometerCtrl
    AccelerometerSimulatorDriver ..u[dotted]> Acceleration3d
    AccelerometerDriverProvider ..u[dotted]|> Observer
    AccelerometerDriverProvider ..u[dotted]> Subject
    AccelerometerDriverProvider -> AccelerometerConfigStorage
    AccelerometerDriverProvider --u> RealAccelerometerDriver
    AccelerometerDriverProvider --u> AccelerometerSimulatorDriver
    AccelerometerDriverProvider --u> AccelerometerDriver
}
package button_driver {
    class ButtonDriver
    ButtonDriver --u> ButtonCtrl
}
package os {
    class os_Interrupts
    class os_KeyHandler
    class os_Time
    class os_Task
    class os_Scheduler
    class Os
    Os -> os_KeyHandler
    Os --u> os_Scheduler
    os_KeyHandler -> Os
    os_KeyHandler ..u[dotted]> os_Interrupts
    os_Interrupts ..u[dotted]> ButtonDriver
    os_Interrupts ..u[dotted]> AccelerometerDriver
    os_Interrupts ..u[dotted]> RealAccelerometerDriver
    os_Interrupts ..u[dotted]> AccelerometerSimulatorDriver
    os_Scheduler --u> ButtonDriver
    os_Scheduler --u> AccelerometerDriverProvider
    os_Scheduler --u> MotionDetector
    os_Scheduler --u> os_Task
    os_Scheduler ..u[dotted]> AccelerometerConfigStorage
    os_Scheduler ..u[dotted]> AccelerometerConfigurator
    os_Scheduler ..u[dotted]> AccelerometerDriver
    os_Scheduler ..u[dotted]> ButtonCtrl
    os_Scheduler ..u[dotted]> os_Time
    os_Scheduler ..u[dotted]> Timer
    os_Task -> os_Time
    os_Time ..u[dotted]|> TimeSource
}
accelerometer_data_models --u[hidden] lib
motion_detector --u[hidden] accelerometer_data_models
accelerometer_controller ---u[hidden] motion_detector
accelerometer_driver --u[hidden] accelerometer_controller
os ----u[hidden] accelerometer_driver
os ----u[hidden] button_driver
os ----u[hidden] accelerometer_data_storage
----
